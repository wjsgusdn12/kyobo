<div layout:fragment="content" class="main_area">
	<style>
		*{
			box-sizing: border-box;
			padding:0;
			margin:0;
			transition: background-color 0.5s ease;
		}
		.main_area{
			width:100%;
			height:100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.find_account_section{
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
			height: 100%;
		}
		.home_logo_button{
			width:171px;
			height:56px;
			margin-bottom: 50px;
		}
		.find_account_form{
			width: 350px;
			height: 600px;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items: center;
		}
		.find_id_section{
			width: 100%;
			height: 100%;
		}
		.find_id_link_form_id {
		    width: 50%;
		    height: 45px;
		    color: #474c98;
		    font-weight: bold;
			font-size: 15px;
		    border: 2px solid #474c98;
			border-radius: 5px 5px 0px 0px;
		    border-bottom: none;
			display: flex;
		    align-items: center;
		    justify-content: center;
			cursor: pointer;
		}
		.find_pw_link_form_id {
		    width: 50%;
		    height: 45px;
		    color: #767676;
			font-size: 15px;
		    border: 1px solid #767676;
			border-radius: 5px 5px 0px 0px;
		    border-bottom: 2px solid #474c98;
		    border-left: none;
			display: flex;
		    align-items: center;
		    justify-content: center;
			cursor: pointer;
		}
		.find_id_link_form_pw {
		    width: 50%;
		    height: 45px;
			color: #767676;
			font-size: 15px;
			border: 1px solid #767676;
			border-radius: 5px 5px 0px 0px;
			border-bottom: 2px solid #474c98;
			border-right: none;
			display: flex;
		    align-items: center;
		    justify-content: center;
			cursor: pointer;
		}
		.find_pw_link_form_pw {
		    width: 50%;
		    height: 45px;
			color: #474c98;
			font-weight: bold;
			font-size: 15px;
			border: 2px solid #474c98;
			border-radius: 5px 5px 0px 0px;
			border-bottom: none;
			display: flex;
		    align-items: center;
		    justify-content: center;
			cursor: pointer;
		}
		.find_account_link_area{
			width:100%;
			height:45px;
			display: flex;
		}
		.find_id_form{
			width:100%;
			padding: 15px;
			border: 1px solid lightgray;
			border-radius: 10px;
			margin-top: 50px;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		.find_form_text{
			width: 100%;
			height: 30px;
			font-weight: bold;
			font-size: 15px;
		}
		.find_form_input{
			width: 100%;
			height: 40px;
			padding: 10px;
			margin-top: -3px;
			margin-bottom: 10px;
			border: 1px solid lightgray;
			border-radius: 5px;
		}
		.find_form_input:focus{
			outline: none;
		    border: 1px solid #474c98;
		    box-shadow: 0 0 5px rgba(71, 76, 152, 0.5);
		}
		.find_form_submit{
			width: 100%;
			height: 40px;
			color: white;
			font-size: 15px;
			font-weight: bold;
			background-color: lightgray;
			border-radius: 5px;
			border: none;
		}
		.find_form_submit.on{
			width: 100%;
			height: 40px;
			color: white;
			font-size: 15px;
			font-weight: bold;
			background-color: #474c98;
			border-radius: 5px;
			border: none;
		}
		.find_form_submit.on:hover{
			background-color:#2c307c;
			cursor: pointer;
		}
		input[type="number"]::-webkit-inner-spin-button,
		input[type="number"]::-webkit-outer-spin-button {
		    -webkit-appearance: none;
		    margin: 0;
		}
		.warning-text {
		    color: red;
		    font-size: 13px;
		    margin-top: -5px;
		    margin-bottom: 10px;
		    width: 100%;
		}
		.test_id_text{
			color:red; 
			font-weight:bold;
			display: flex;
			align-items: center;
			justify-content: center;
			margin:20px 0px -20px 0px;
		}
	</style>
	<div class="find_account_form">
		<a class="home_logo_button" th:href="@{/}">
            <img class="home_logo_button" src="https://contents.kyobobook.co.kr/resources/fo/images/common/ink/img_logo_kyobo_member@2x.png">
        </a>
		<div id="idSection" class="find_account_section" style="display: none;">
			<div class="find_id_section">
				<div class="find_account_link_area">
					<div class="find_id_link_form_id">아이디 찾기</div>
					<div class="find_pw_link_form_id">비밀번호 찾기</div>
				</div>
				<span class="test_id_text">
					이름 : 테스트<br/>
					휴대폰번호 : 01099999999
				</span>
				<form class="find_id_form" th:action="@{|/member/find_result|}" id="findIdFormFromId" method="post">
					<div class="find_form_text">이름</div>
					<input class="find_form_input" type="text" name="name" id="name" placeholder="이름을 입력해 주세요."/>
					<div class="warning-text" id="name-warning" style="display:none;">이름을 입력해 주세요.</div>
					<div class="find_form_text no-spin">휴대폰번호</div>
					<input class="find_form_input" type="number" name="phone" id="phone" placeholder="숫자만 입력해 주세요."/>
					<div class="warning-text" id="phone-warning" style="display:none;">휴대폰 번호를 입력해 주세요.</div><br/>
					<div id="error-message-from-id" class="error-message-from-id" style="display:none; color: red;"></div>
					<input class="find_form_submit" type="submit" value="확인"/>
				</form>
			</div>
		</div>
		<div id="pwSection" class="find_account_section" style="display: none;">
			<div class="find_pw_section">
				<div class="find_account_link_area">
					<div class="find_id_link_form_pw">아이디 찾기</div>
					<div class="find_pw_link_form_pw">비밀번호 찾기</div>
				</div>
				<span class="test_id_text">
					아이디 : test<br/>
					이름 : 테스트<br/>
					휴대폰번호 : 01099999999
				</span>
				<form class="find_id_form" th:action="@{|/member/reset-password|}" id="findIdFormFromPw" method="post">
				    <div class="find_form_text">아이디</div>
				    <input class="find_form_input" type="text" name="id" id="id" placeholder="아이디를 입력해 주세요."/>
				    <div class="warning-text" id="id-warning" style="display:none;">아이디를 입력해 주세요.</div>
				    <div class="find_form_text">이름</div>
				    <input class="find_form_input" type="text" name="name" id="name" placeholder="이름을 입력해 주세요."/>
				    <div class="warning-text" id="name-warning" style="display:none;">이름을 입력해 주세요.</div>
				    <div class="find_form_text no-spin">휴대폰번호</div>
				    <input class="find_form_input" type="number" name="phone" id="phone" placeholder="숫자만 입력해 주세요."/>
				    <div class="warning-text" id="phone-warning" style="display:none;">휴대폰 번호를 입력해 주세요.</div><br/>
				    <div id="error-message" class="error-message" style="display:none; color: red;"></div>
				    <input class="find_form_submit" type="submit" value="확인"/>
				</form>
			</div>
		</div>
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
		    const idSection = document.getElementById('idSection');
		    const pwSection = document.getElementById('pwSection');
	
		    const idForm = idSection.querySelector('form');
		    const pwForm = pwSection.querySelector('form');
	
		    const idFormInputs = {
		        name: idForm.querySelector('input[name="name"]'),
		        phone: idForm.querySelector('input[name="phone"]'),
		        submit: idForm.querySelector('.find_form_submit'),
		        nameWarning: idForm.querySelector('#name-warning'),
		        phoneWarning: idForm.querySelector('#phone-warning'),
		    };
	
		    const pwFormInputs = {
		        id: pwForm.querySelector('input[name="id"]'),
		        name: pwForm.querySelector('input[name="name"]'),
		        phone: pwForm.querySelector('input[name="phone"]'),
		        submit: pwForm.querySelector('.find_form_submit'),
		        idWarning: pwForm.querySelector('#id-warning'),
		        nameWarning: pwForm.querySelector('#name-warning'),
		        phoneWarning: pwForm.querySelector('#phone-warning'),
		    };
	
		    function setupValidation(inputs, fields) {
		        fields.forEach(field => {
		            const input = inputs[field];
		            const warning = inputs[`${field}Warning`];
	
		            input.addEventListener('blur', () => {
		                warning.style.display = input.value.trim() === '' ? 'block' : 'none';
		                checkValidity(inputs, fields);
		            });
	
		            input.addEventListener('input', () => {
		                warning.style.display = 'none';
		                checkValidity(inputs, fields);
		            });
		        });
	
		        inputs.submit.addEventListener('click', function (e) {
		            if (!inputs.submit.classList.contains('on')) {
		                e.preventDefault();
		            }
		        });
		    }
	
		    function checkValidity(inputs, fields) {
		        const allValid = fields.every(field => inputs[field].value.trim() !== '');
		        if (allValid) {
		            inputs.submit.classList.add('on');
		            inputs.submit.disabled = false;
		        } else {
		            inputs.submit.classList.remove('on');
		            inputs.submit.disabled = true;
		        }
		    }
	
		    setupValidation(idFormInputs, ['name', 'phone']);
		    setupValidation(pwFormInputs, ['id', 'name', 'phone']);
	
		    const idTab = document.querySelector('.find_id_link_form_id');
		    const pwTab = document.querySelector('.find_pw_link_form_id');
		    const idTabFromPw = document.querySelector('.find_id_link_form_pw');
		    const pwTabFromPw = document.querySelector('.find_pw_link_form_pw');
	
		    function showId() {
		        idSection.style.display = 'block';
		        pwSection.style.display = 'none';
		    }
	
		    function showPw() {
		        idSection.style.display = 'none';
		        pwSection.style.display = 'block';
		    }
	
		    idTab?.addEventListener('click', showId);
		    pwTab?.addEventListener('click', showPw);
		    idTabFromPw?.addEventListener('click', showId);
		    pwTabFromPw?.addEventListener('click', showPw);
	
		    if (location.hash === '#pw') {
		        showPw();
		    } else {
		        showId();
		    }
			
			document.getElementById('findIdFormFromPw').addEventListener('submit', function(event) {
	            event.preventDefault(); // 기본 폼 제출 동작 방지

				let id = document.querySelector('#findIdFormFromPw #id').value;
			    let name = document.querySelector('#findIdFormFromPw #name').value;
			    let phone = document.querySelector('#findIdFormFromPw #phone').value;

	            let xhr = new XMLHttpRequest();
	            xhr.open('POST', '/kyobo/member/reset-password', true);
	            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

	            let data = 'id=' + encodeURIComponent(id) + '&name=' + encodeURIComponent(name) + '&phone=' + encodeURIComponent(phone);

				xhr.onreadystatechange = function() {
				    if (xhr.readyState === 4) {
				        console.log(xhr.status);  // 상태 코드 로그 출력
				        console.log(xhr.responseText);  // 서버 응답 로그 출력

				        if (xhr.status === 200) {
				            let response = JSON.parse(xhr.responseText);

				            if (response.redirect) {
				                window.location.href = response.redirect;
				            } else if (response.error) {
				                document.getElementById('error-message').textContent = response.error;
				                document.getElementById('error-message').style.display = 'block';
				            }
				        } else {
				            document.getElementById('error-message').textContent = '서버 오류가 발생했습니다. 다시 시도해 주세요.';
				            document.getElementById('error-message').style.display = 'block';
				        }
				    }
				};
	            xhr.send(data);
	        });
			
			document.getElementById('findIdFormFromId').addEventListener('submit', function(event) {
				event.preventDefault();
				
			    let name = document.querySelector('#findIdFormFromId #name').value;
			    let phone = document.querySelector('#findIdFormFromId #phone').value;

	            let xhr = new XMLHttpRequest();
	            xhr.open('POST', '/kyobo/member/find-result', true);
	            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

	            let data = 'name=' + encodeURIComponent(name) + '&phone=' + encodeURIComponent(phone);

				xhr.onreadystatechange = function() {
				    if (xhr.readyState === 4) {
				        console.log(xhr.status);  // 상태 코드 로그 출력
				        console.log(xhr.responseText);  // 서버 응답 로그 출력

				        if (xhr.status === 200) {
				            let response = JSON.parse(xhr.responseText);

				            if (response.redirect) {
				                window.location.href = response.redirect;
				            } else if (response.error) {
				                document.getElementById('error-message-from-id').textContent = response.error;
				                document.getElementById('error-message-from-id').style.display = 'block';
				            }
				        } else {
				            document.getElementById('error-message-from-id').textContent = '서버 오류가 발생했습니다. 다시 시도해 주세요.';
				            document.getElementById('error-message-from-id').style.display = 'block';
				        }
				    }
				};
	            xhr.send(data);
	        });
		});
	</script>
</div>