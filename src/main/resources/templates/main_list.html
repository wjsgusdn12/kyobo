<html layout:decorate="~{layout}">
    <div layout:fragment="content" class="main_area">
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            .main_area {
                display: flex;
                width: 100%;
                height: 100%;
                justify-content: center;
                align-items: center;
            }
            .book_list_area {
                display: flex;
                justify-content: center;
                flex-direction: column;
                width: 920px;
                height: 100%;
            }
            .main_book_div {
                display: flex;
                align-items: center;
                border-bottom: 1px solid lightgray;
                justify-content: space-between;
                padding: 30px;
            }
            .main_book_image {
                width: 144px;
                height: 208px;
                cursor: pointer;
            }
            .main_book_button_area {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                width: 100px;
            }
            .main_book_info {
                display: flex;
                gap: 20px;
            }
            .main_book_info_text {
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 8px;
                width: 560px;
            }
            .main_book_number {
                background-color: rgb(118,118,118);
                width: 22px;
                height: 22px;
                border-radius: 5px;
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-size: 13px;
                font-weight: bold;
            }
            .main_book_title {
                font-weight: bold;
                font-size: 16px;
                color: black;
                width: fit-content;
            }
            .main_book_title:hover {
                cursor: pointer;
                text-decoration: underline;
            }
            .main_book_author {
                color: gray;
                font-size: 15px;
            }
            .main_book_price {
                font-weight: bold;
                font-size: 16px;
            }
            .main_book_desc {
                color: gray;
                font-size: 13px;
				display: -webkit-box;
			  	-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
				text-overflow: ellipsis;
				line-height: 1.4em;
				max-height: 2.8em;
            }
            .main_book_rating_text {
                font-weight: bold;
                font-size: 14px;
                color: black;
            }
            .main_book_rating_size {
                color: gray;
                font-size: 14px;
            }
            .main_book_rating {
                display: flex;
                align-items: center;
                gap: 5px;
            }
            .book_add_cart_button {
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
                font-size: 14px;
                height: 38px;
                border-radius: 0.5rem;
                padding: 0.5625rem 0.875rem;
                background-color: #767676;
                color: white;
                font-weight: 500;
                width: 100%;
                cursor: pointer;
                border: none;
                opacity: 1;
                pointer-events: auto;
            }
            .book_add_cart_button:hover {
                background-color: #1f2937;
                color: white;
            }
            .book_add_cart_button:active {
                background-color: #111827;
            }
            .book_add_cart_button:disabled {
                background-color: #9ca3af;
                cursor: not-allowed;
                opacity: 0.5;
                pointer-events: none;
            }
            .book_buy_button {
                margin-top: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
                font-size: 14px;
                height: 38px;
                border-radius: 0.5rem;
                padding: 0.5625rem 0.875rem;
                background-color: #3b58ab;
                color: white;
                font-weight: 500;
                width: 100%;
                cursor: pointer;
                border: none;
                opacity: 1;
                pointer-events: auto;
            }
            .book_buy_button:hover {
                background-color: #1e3a8a;
                color: white;
            }
            .book_buy_button:active {
                background-color: #1e3a8a;
            }
            .book_buy_button:disabled {
                background-color: #60a5fa;
                border: 1px solid #60a5fa;
                color: white;
                opacity: 0.5;
                pointer-events: none;
            }
            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-top: 20px;
                gap: 10px;
            }
            .pagination a {
                padding: 8px 12px;
                background-color: #f4f4f4;
                border-radius: 5px;
                text-decoration: none;
                color: #333;
                font-weight: bold;
                font-size: 14px;
                cursor: pointer;
                opacity: 1;
                pointer-events: auto;
            }
            .pagination a:hover {
                background-color: #ddd;
            }
            .pagination a.active {
                background-color: #3b58ab;
                color: white;
            }
            .pagination a.off {
                background-color: #ccc;
                color: #999;
                opacity: 0.5;
                pointer-events: none;
                cursor: not-allowed;
            }
			.main_book_isbn{
				display: none;
			}
			.main_book_title:hover {
			    cursor: pointer;
			    text-decoration: underline;
			    color: #3b58ab;
			    transition: color 0.3s ease;
			}

			.book_add_cart_button:hover {
			    background-color: #555555;
			    color: #ffffff;
			    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
			    transform: translateY(-2px);
			    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
			}

			.book_buy_button:hover {
			    background-color: #1e3a8a;
			    color: white;
			    box-shadow: 0 4px 12px rgba(30, 58, 138, 0.6);
			    transform: translateY(-2px);
			    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
			}

			.main_book_image:hover {
			    cursor: pointer;
			    filter: brightness(90%);
			    transform: scale(1.05);
			    transition: filter 0.3s ease, transform 0.3s ease;
			}

			.pagination a:hover:not(.off):not(.active) {
			    background-color: #3b58ab;
			    color: white;
			    transition: background-color 0.3s ease, color 0.3s ease;
			}

			.pagination a.active {
			    box-shadow: 0 0 8px #3b58ab;
			    transition: box-shadow 0.3s ease;
			}
			.main_book_div:hover {
			    background-color: rgb(247, 247, 247);
			    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				cursor: pointer;
			}
        </style>
        <div class="book_list_area">
            <h1>2024 연간 베스트셀러</h1>
            <div th:each="book : ${paging.content}">
                <div class="main_book_div">
                    <div class="main_book_info">
                        <img class="main_book_image" th:src="@{${book.thumbnail}}" fetchpriority="high" loading="eager" width="144" height="208" decoding="async" data-nimg="1" style="color: transparent; width: 144px; height: auto; max-height: 208px; object-fit: fill;">
                        <div class="main_book_info_text">
							<div class="main_book_isbn" th:text="${book.isbn}"></div>
                            <div class="main_book_number" th:text="${book.bookIdx}"></div>
                            <div class="main_book_title" th:text="${book.bookName}"></div>
                            <div class="main_book_author" th:text="${book.author.authorName}+' · '+${book.publisher}+' · '+${#temporals.format(book.publicationDate, 'yyyy.MM.dd')}"></div>
                            <div class="main_book_price" th:text="${book.price}+'원'"></div>
                            <div class="main_book_desc" th:text="${book.introduction}"></div>
                            <div class="main_book_rating">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4DAC27" viewBox="0 0 17 16" stroke="none" style="margin-top: 2px;">
                                    <g clip-path="url(#ico_clover_svg__a)">
                                        <path fill="current" d="M8.489 13.546V7.817h3.139a2.4 2.4 0 0 1 2.4 2.403v.092a2.403 2.403 0 0 1-2.4 2.403h-.74a2.4 2.4 0 0 1-1.476-.52v1.343a.462.462 0 0 1-.923 0zm-4.062-.822a2.397 2.397 0 0 1-2.4-2.403v-.092a2.405 2.405 0 0 1 2.4-2.402h3.139v2.494a2.404 2.404 0 0 1-2.4 2.403zm4.062-5.827V4.402A2.403 2.403 0 0 1 10.889 2h.739a2.4 2.4 0 0 1 2.4 2.402v.093a2.403 2.403 0 0 1-2.4 2.402zm-4.062 0a2.4 2.4 0 0 1-1.697-.703 2.4 2.4 0 0 1-.703-1.7v-.092A2.403 2.403 0 0 1 4.427 2h.74a2.4 2.4 0 0 1 2.399 2.402v2.495z"></path>
                                    </g>
                                </svg>
                                <span class="main_book_rating_text" th:text="${#numbers.formatDecimal(book.avgScore != null ? book.avgScore : 0, 1, 1)}"></span>
                                <span class="main_book_rating_size" th:text="'('+${book.reviewCount}+'개의 리뷰)'"></span>
                            </div>
                        </div>
                    </div>
                    <div class="main_book_button_area">
                        <input type="button" class="book_add_cart_button" value="장바구니"/>
                        <input sec:authorize="isAnonymous()" type="button" class="book_buy_button" value="구매하기" th:onclick="|alert('로그인 후 이용해주세요.'); location.href='@{/login}'|"/>
                        <input sec:authorize="isAuthenticated()" type="button" class="book_buy_button real" value="구매하기"/>
                    </div>
                </div>
            </div>

			<div class="pagination">
			    <a th:href="@{|/?page=${paging.number - 1}|}" 
			       th:classappend="${paging.first} ? 'off' : ''" class="previous">
			        이전
			    </a>

				<span th:each="i : ${pageNumbers}">
				    <a th:href="@{|/?page=${i}|}" th:text="${i + 1}" 
				       th:classappend="${i == paging.number} ? 'active' : ''"></a>
				</span>

			    <a th:href="@{|/?page=${paging.number + 1}|}" 
			       th:classappend="${paging.last} ? 'off' : ''" class="next">
			        다음
			    </a>
			</div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const bookPrices = document.querySelectorAll('.main_book_price');
                
                bookPrices.forEach(function(priceElement) {
                    let price = priceElement.textContent.replace('원', '').trim();
                    if (price) {
                        let formattedPrice = formatPrice(price);
                        priceElement.textContent = formattedPrice + '원';
                    }
                });

                function formatPrice(price) {
                    return Number(price).toLocaleString('ko-KR');
                }
				
				document.addEventListener('click', function(e){
					if(e.target.classList.contains("book_add_cart_button")){
						let bookDiv = e.target.closest(".main_book_div");
						let isbn = bookDiv.querySelector(".main_book_isbn")?.textContent.trim();
						$.ajax({
							method: 'post',
							data: {isbn: isbn},
							url: '/kyobo/cart/insert',
							success: function () {
								location.href="/kyobo/orderPayment";
							},
							error: function (r, s, e) {
								alert("로그인 후 이용해주세요.");
								location.href="/kyobo/login";
							}
						});
					} else if (e.target.classList.contains("book_buy_button") && 
								e.target.classList.contains("real")) {
						let bookDiv = e.target.closest(".main_book_div");
						let isbn = bookDiv.querySelector(".main_book_isbn")?.textContent.trim();
						location.href="/kyobo/order/buynow?isbn="+isbn;
					} else if (e.target.classList.contains("main_book_image") || 
					    	   e.target.classList.contains("main_book_title") ||
							   e.target.closest(".main_book_div")) {
						let bookDiv = e.target.closest(".main_book_div");
						let isbn = bookDiv.querySelector(".main_book_isbn")?.textContent.trim();
						location.href="/kyobo/detail/"+isbn;
					}
				});
            });
        </script>
    </div>
</html>
