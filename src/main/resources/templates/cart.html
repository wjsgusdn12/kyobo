<html layout:decorate="~{layout}">
<th:block layout:fragment="css">
	<style>
		.nav {
			width: 100%;
			height: 122px;
			background-color: pink;
		}
		.footer {
			width: 100%;
			height: 302px;
			background-color: cornflowerblue;
		}
		.content {
			width: 1200px;
			margin: 0 auto;
		}
		/*장바구니 탑 */
		.cart_top_wrap {
			margin: 30px 0;
		}
		.cart_top_wrap_title {
			display: flex;
			gap: 21px;
			align-items: center;
		}
		.cart_top_wrap_left_one>span {
			font-size: 24px;
			font-weight: 700;
		}
		.location_icon {
			display: inline-block;
			width: 13px;
			height: 19px;
			background: url(https://contents.kyobobook.co.kr/resources/fo/images/common/ink/ico_locate_black@2x.png) left center no-repeat;
			background-size: 13px 19px;
		}
		.cart_top_wrap_left_two {
			width: 79px;
			height: 38px;
			border: 1px solid #ccc;
			border-radius: 13px;
			text-align: center;
			padding: 4px;
			box-sizing: border-box;
			font-size: 14px;
		}
		.active {
			background-color: #4dac27;
		}
		.inactive {
			background-color: #d5d5d5;
		}
		.cart_top_wrap_right {
			width: 369px;
			align-items: center;
			margin-left: 537px;
			display: flex;
			justify-content: space-around;
		}
		.page_icon {
			width: 20px;
			height: 20px;
			border-radius: 50%;
			color: white;
			display: inline-block;
			text-align: center;
		}
		.active_part {
			font-weight: 700;
		}
		.inactive_part {
			color: #d5d5d5;
		}
		/*장바구니 탑 */
		.cart_top_wrap_second {
			width: 896px;
			height: 44px;
			margin: 30px 0;
		}
		.cart_kyoboicon {
			width: 81px;
			height: 36px;
			border: 1px solid #d5d5d5;
			border-radius: 20px;
			box-sizing: border-box;
			padding: 9px;
		}
		/*order list tab*/
		.order_totalcount {
			width: 890px;
			height: 60px;
			border-top: 1px solid #eaeaea;
			box-sizing: border-box;
			padding: 15px 0;
		}
		.check_icon_outer {
			width: 22px;
			height: 22px;
			border-radius: 50%;
			background-color: #832383;
			display: inline-block;
			box-sizing: border-box;
			padding-left: 5px;
			margin-right: 10px;
			cursor: pointer;
		}
		.check_icon_inner {
			background: url(https://contents.kyobobook.co.kr/resources/fo/images/common/ink/ico_checkbox_active@2x.png);
			width: 10px;
			height: 7px;
			background-size: 10px 7px;
			display: inline-block;
		}
		.order_totalcount>span {
			font-size: 17px;
			font-weight: 700;
		}
		/*order list tab*/
		/*카트 리스트 */
		.cart_list {
			display: flex;
			width: 890px;
			height: 175px;
			box-sizing: border-box;
			border-top: 1px solid #eaeaea;
		}
		.cart_list_first {
			box-sizing: border-box;
			padding: 20px 0;
		}
		.cart_list_second {
			box-sizing: border-box;
			padding: 20px 0;
			position: relative;
			width: 486px;
			border-right: 1px solid #eaeaea;
		}
		.book_img_div {
			display: inline-block;
		}
		.book_img_div>img {
			width: 82px;
		}
		.cart_list_second_title {
			font-size: 15px;
			font-weight: 700;
			position: absolute;
			left: 104px;
		}
		.cart_list_second_price {
			font-weight: 600;
			color: #6a6a6a;
			position: absolute;
			left: 103px;
			top: 51px;
		}
		.cart_list_thrid {
			border-right: 1px solid #eaeaea;
			width: 140px;
			box-sizing: border-box;
			padding: 44px 30px;
		}
		.cart_list_thrid_price {
			font-weight: 700;
		}
		.quantity_check {
			display: flex;
		}
		.quantity_check>button {
			width: 27px;
			height: 30px;
			border-top: 1px solid #ccc;
			border-bottom: 1px solid #ccc;
			background: white;
			cursor: pointer;
		}
		.quantity_check>input {
			width: 27px;
			height: 26px;
			border-top: 1px solid #ccc;
			border-bottom: 1px solid #ccc;
			border-right: none;
			border-left: none;
			text-align: center;
		}
		.left_btn {
			border-radius: 4px 0 0 4px;
			border-right: none;
			border-left: 1px solid #ccc;
		}
		.right_btn {
			border-left: none;
			border-radius: 0 4px 4px 0;
			border-right: 1px solid #ccc;
		}
		.cart_list_fourth_left {
			width: 200px;
			box-sizing: border-box;
			padding: 25px;
		}
		.cart_list_fourth_right {
			margin-top: 11px;
		}
		.sameDay_delivary {
			width: 59px;
			height: 26px;
			font-size: 12px;
			background: #ededf7;
			border-radius: 20px;
			color: #474c98;
			box-sizing: border-box;
			padding: 6px;
			margin-bottom: 10px;
		}
		.cart_list_fourth {
			display: flex;
			width: 222px;
		}
		.cart_list_fourth_left>span {
			font-size: 14px;
			font-weight: 700;
		}
		.cart_list_deleteBtn {
			width: 21px;
			height: 21px;
			display: inline-block;
			background: url(https://contents.kyobobook.co.kr/resources/fo/images/common/ink/btn_delete_ord@2x.png);
			background-size: 21px 21px;
			cursor: pointer;
		}
		/*카트 리스트 */
		.payment_promotion>img {
			width: 890px;
			height: auto;
		}
		.cart_note>img {
			width: 890px;
			height: auto;
		}
		/*결제 정보 알림박스 */
		.payment_info {
			width: 273px;
			height: 252px;
			box-sizing: border-box;
			padding: 20px;
			border: 1px solid #ccc;
			border-radius: 20px;
			position: fixed;
			top: 229px;
			right: 67px;
			background: white;
		}
		.payment_info_first {
			height: 73px;
			border-bottom: 1px solid;
		}
		.payment_info_first_part {
			display: flex;
			justify-content: space-around;
			margin: 10px 0;
		}
		.payment_info_first_price {
			font-weight: 700;
		}
		.payment_info_second {
			height: 56px;
			display: flex;
			justify-content: space-around;
			align-items: center;
		}
		.payment_info_second>span {
			font-weight: 700;
		}
		.payment_info_second_price {
			font-size: 20px
		}
		.payment_info_orderBtn {
			background: #832383;
			border: none;
			color: white;
			width: 130px;
			height: 40px;
			border-radius: 10px;
			margin-left: 52px;
			margin-top: 16px;
			cursor: pointer;
		}
		/*결제 정보 알림박스 */
	</style>
</th:block>
<th:block layout:fragment="script">
	<script>
		//책 체크 
		document.querySelectorAll('.check_icon_outer').forEach(function (item) {
			item.addEventListener('click', function () {
				const color = window.getComputedStyle(item).backgroundColor;
				const inner = item.querySelector('.check_icon_inner'); // 자식 요소 선택

				if (color === 'rgb(131, 35, 131)') { // '#832383'은 rgb로 바꿔야 함
					item.style.border = '2px solid #eaeaea'
					item.style.backgroundColor = 'white';
					if (inner) {
						inner.style.backgroundImage = 'url("https://contents.kyobobook.co.kr/resources/fo/images/common/ink/ico_checkbox@2x.png")';
					}
				} else {
					item.style.border = 'none';
					item.style.backgroundColor = '#832383';
					if (inner) {
						inner.style.backgroundImage = 'url("https://contents.kyobobook.co.kr/resources/fo/images/common/ink/ico_checkbox_active@2x.png")';
					}
				}
			});
		});

		//장바구니 상품을 제거
		document.querySelectorAll('.cart_list_deleteBtn').forEach(function (item) {
			item.addEventListener('click', function (event) {
				const isConfirmed = confirm("선택 상품을 삭제하시겠어요?");
				if (!isConfirmed) {
					event.preventDefault(); // 클릭 동작 막기 (예: form 전송 등)
				}
				// 확인 눌렀을 경우에는 그냥 진행
			});
		});

		//상품수량 변경 후 총 가격 변경 (-)
		document.querySelectorAll('.left_btn').forEach(function (item) {
		  item.addEventListener('click', function () {
		    const countCheck = item.parentElement.querySelector('input');
		    let countValue = parseInt(countCheck.value);

		    if (countValue > 1) {
		      countValue--;
		      countCheck.value = countValue;
		    } else {
		      return; // 1보다 작아질 수 없음
		    }

		    // 부모 cart_list 요소 찾기
		    const cartList = item.closest('.cart_list');

		    // 선택 여부 확인
		    const checkIcon = cartList.querySelector('.check_icon_outer');
		    const bgColor = window.getComputedStyle(checkIcon).backgroundColor;

		    // 선택된 항목일 경우만 계산 수행
		    if (bgColor === 'rgb(131, 35, 131)') {
		      const unitPriceText = cartList.querySelector('.cart_list_second_price').textContent;
		      const unitPrice = parseInt(unitPriceText.replace(/[^\d]/g, ''));
		      const totalPrice = unitPrice * countValue;

		      const priceDisplay = cartList.querySelector('.cart_list_thrid_price');
		      priceDisplay.textContent = totalPrice.toLocaleString() + '원';

		      // 결제 금액 및 수량 업데이트
		      updateTotalPrice();
		      updateTotalQuantity();
		    } else {
		      // 선택 안 된 항목은 가격만 계산
		      const unitPriceText = cartList.querySelector('.cart_list_second_price').textContent;
		      const unitPrice = parseInt(unitPriceText.replace(/[^\d]/g, ''));
		      const totalPrice = unitPrice * countValue;

		      const priceDisplay = cartList.querySelector('.cart_list_thrid_price');
		      priceDisplay.textContent = totalPrice.toLocaleString() + '원';

		      console.log('선택되지 않은 항목입니다.');
		    }
		  });
		});

		//상품수량 변경 후 총 가격 변경 (+) ** 다시 복습 
		document.querySelectorAll('.right_btn').forEach(function (item) {
			item.addEventListener('click', function () {
				const countInput = item.parentElement.querySelector('input');
				let countvalue = parseInt(countInput.value);
				countvalue++;
				countInput.value = countvalue;

				const cartList = item.closest('.cart_list');

				// 선택 여부 확인
				const checkIcon = cartList.querySelector('.check_icon_outer');
				const bgColor = window.getComputedStyle(checkIcon).backgroundColor;

				// 선택된 항목일 경우만 계산 수행
				if (bgColor === 'rgb(131, 35, 131)') {
					const cartPrice = cartList.querySelector('.cart_list_second_price').textContent;
					const unitPrice = parseInt(cartPrice.replace(/[^\d]/g, ''));
					const totalPrice = unitPrice * countvalue;
					const priceDisplay = cartList.querySelector('.cart_list_thrid_price');
					priceDisplay.textContent = totalPrice.toLocaleString() + '원';

					// 결제 예정 금액 업데이트
					updateTotalPrice();

					// 👉 여기서 전체 수량 합계도 업데이트할 수 있음
					updateTotalQuantity(); // 이런 함수로 따로 관리 추천
				} else {
					//선택 되지 않았을때는 수량체크 위에 가격만 변동이 일어남 
					const cartPrice = cartList.querySelector('.cart_list_second_price').textContent;
					const unitPrice = parseInt(cartPrice.replace(/[^\d]/g, ''));
					const totalPrice = unitPrice * countvalue;
					const priceDisplay = cartList.querySelector('.cart_list_thrid_price');
					priceDisplay.textContent = totalPrice.toLocaleString() + '원';
					console.log('선택된 항목이 아님');
				}
			});
		});

		//결제 예정 금액 
		function updateTotalPrice() {
			let total = 0;

			// 각 가격을 가져와서 합산
			document.querySelectorAll('.cart_list_thrid_price').forEach(function (item) {
				const priceText = item.textContent;
				// 숫자만 추출
				const price = parseInt(priceText.replace(/[^\d]/g, ''));

				// 가격을 총합에 더하기
				total += price;
			});

			// 결제 금액을 업데이트
			const totalDisplay = document.querySelector('.payment_info_first_price');
			const paymentPrice = document.querySelector('.payment_info_second_price');
			if (totalDisplay) {
				totalDisplay.textContent = total.toLocaleString() + '원'; // 천 단위로 쉼표 추가
				paymentPrice.textContent = total.toLocaleString();
			}
		}

		// 수량 변화 ** 다시 복습 
		function updateTotalQuantity() {
		  let totalQuantity = 0;

		  document.querySelectorAll('.cart_list').forEach(function(cartItem) {
		    const checkIcon = cartItem.querySelector('.check_icon_outer');
		    const bgColor = window.getComputedStyle(checkIcon).backgroundColor;

		    if (bgColor === 'rgb(131, 35, 131)') {
		      const input = cartItem.querySelector('.quantity_check input');
		      const count = parseInt(input.value);
		      totalQuantity += count;
		    }
		  });

		  // 결과 출력
		  const quantityDisplay = document.querySelector('.payment_info_count');
		  if (quantityDisplay) {
		    quantityDisplay.textContent = totalQuantity.toLocaleString();
		  }
		}
	</script>
</th:block>
<div layout:fragment="nav" class="nav"></div>
<div layout:fragment="content" class="content">
	<!--cart top 부분 -->
	<div class="cart_top_wrap">
		<div class="cart_top_wrap_title">
			<div class="cart_top_wrap_left_one">
				<span>장바구니</span>
				<span>(</span>
				<span>1</span>
				<span>)</span>
			</div>
			<div class="cart_top_wrap_left_two">
				<span class="location_icon"></span>
				윤지수
			</div>
			<div class="cart_top_wrap_right">
				<div>
					<div class="page_icon active">1</div>
					<span class="active_part">장바구니</span>
				</div>
				<div>
					<div class="page_icon inactive">2</div>
					<span class="inactive_part">주문 / 결제</span>
				</div>
				<div>
					<div class="page_icon inactive">3</div>
					<span class="inactive_part">주문 완료</span>
				</div>
			</div>
		</div>
		<div class="cart_top_wrap_second">
			<div class="cart_kyoboicon">교보문고</div>
		</div>
	</div>
	<!--cart top 부분 -->
	<!--cart content 부분 -->
	<div class="cart_content_wrap">
		<div class="order_list_tab">
			<div class="order_totalcount">
				<div class="check_icon_outer">
					<span class="check_icon_inner"></span>
				</div>
				<span>교보문고</span>
			</div>
			<!--장바구니 책 리스트 -->
			<div class="cart_list_wrap">
				<div class="cart_list">
					<div class="cart_list_first">
						<div class="check_icon_outer">
							<span class="check_icon_inner"></span>
						</div>
					</div>
					<div class="cart_list_second">
						<div class="book_img_div">
							<img th:src="@{/img/소년이온다 .jpg}">
						</div>
						<span class="cart_list_second_title">[국내도서] 소년이 온다 </span><br>
						<span class="cart_list_second_price">13,500 원</span>
					</div>
					<div class="cart_list_thrid">
						<span class="cart_list_thrid_price">13,5000원</span>
						<div class="quantity_check">
							<button class="left_btn">-</button>
							<input value="1">
							<button class="right_btn">+</button>
						</div>
					</div>
					<div class="cart_list_fourth">
						<div class="cart_list_fourth_left">
							<div class="sameDay_delivary">당일 배송</div>
							<span>오늘</span>
							<span>(5/8)</span>
							<span>배송</span>
						</div>
						<div class="cart_list_fourth_right">
							<span class="cart_list_deleteBtn"></span>
						</div>
					</div>
				</div>
				<div class="cart_list">
					<div class="cart_list_first">
						<div class="check_icon_outer">
							<span class="check_icon_inner"></span>
						</div>
					</div>
					<div class="cart_list_second">
						<div class="book_img_div">
							<img th:src="@{/img/소년이온다 .jpg}">
						</div>
						<span class="cart_list_second_title">[국내도서] 소년이 온다 </span><br>
						<span class="cart_list_second_price">13,500 원</span>
					</div>
					<div class="cart_list_thrid">
						<span class="cart_list_thrid_price">13,5000원</span>
						<div class="quantity_check">
							<button class="left_btn">-</button>
							<input value="4" class="cart_list_countCheck">
							<button class="right_btn">+</button>
						</div>
					</div>
					<div class="cart_list_fourth">
						<div class="cart_list_fourth_left">
							<div class="sameDay_delivary">당일 배송</div>
							<span>오늘</span>
							<span>(5/8)</span>
							<span>배송</span>
						</div>
						<div class="cart_list_fourth_right">
							<span class="cart_list_deleteBtn"></span>
						</div>
					</div>
				</div>
			</div>
			<!--장바구니 책 리스트 -->
		</div>
		<div class="payment_info">
			<div class="payment_info_first">
				<div class="payment_info_first_part">
					<span>상품 금액</span>
					<div>
						<span class="payment_info_first_price">27,000</span>
						<span>원</span>
					</div>
				</div>
				<div class="payment_info_first_part">
					<span>배송비</span>
					<span>+0원</span>
				</div>
			</div>
			<div class="payment_info_second">
				<span>결제 예정 금액</span>
				<span class="payment_info_second_price">27,000</span>
				<span>원</span>
			</div>
			<button class="payment_info_orderBtn">
				주문하기
				<span class="payment_info_count">2</span>
			</button>
		</div>
		<div class="payment_promotion">
			<img th:src="@{/img/결제 프로모션.png}">
		</div>
		<div class="cart_note">
			<img th:src="@{/img/장바구니.png}">
		</div>
	</div>
	<!--cart content 부분 -->
</div>
<div layout:fragment="footer" class="footer"></div>

</html>